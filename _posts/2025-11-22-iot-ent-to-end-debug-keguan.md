---
layout: post
title: 物联网端到端调试（客观篇）
date: 2025-11-22 00:51 +0800
---
# 硬件相关

## 常见术语

### 电气设备
1. PLC
	- 本地自动化、流程控制器
	- 生产线、泵站、闸站等现场控制
2. RTU
	- 采集、通信
	- 气象、水文等遥测站
3. 继电器
4. 传感器
5. 物联网卡
	- 会有定向或绑定设备

### 协议

###### 硬件协议

1. RS-485
	- OSI 物理层 差分信号双绞线、
	-  通常是2线半双工或4线全双工
	-  **没有规定通信协议**
	-  语境是**协议**多半是**Modbus-RTU**
2. RS-232 (物理接口标准 9Pin或20Pin)
3. Modbus-RTU
	- 基于RS-485的通信协议
	- 主从架构
4. 4～20mA
	- 模拟信号标准
	- 4mA表示0% 20mA表示100%

###### 软硬件通信协议

1. TCP（OSI传输层协议）
2. MQTT（发布、订阅）
3. OPC-UA（问询和 发布、订阅）
4.  Modbus-TCP（问询）

# 网络相关

## 链路不通怎么办

链路不通根据具体原因可以采取**自上而下**或**自下而上**逐级进行排除。
1. 终端设备
	- 电源
	- 设备配置：IP、端口、用户名、密码
	- 4G（欠费？定向或绑定设备？）
2. 防火墙
	- 网络测试工具 Ping Telnet等
	- Mock Client 测试
3. 服务端
	- 报文规范？

## 协议分析

对于标准协议，各个厂商实现方式也有所不同。使用抓包工具分析网络协议尤为重要。
协议分析分为3个部分，捕获报文通常使用**tcpdump**或**Wireshark**，分析网络协议通常使用**Wireshark**，逆向网络协议通常使用**ImHex**
1. 捕获网络流量。**tcpdump**是一个强大的网络流量分析工具，同时也可以将过滤后的网络流量存储到文件。
	- 多网卡注意选择网卡
	- 过滤端口
	- 保存文件
2. 分析网络协议。**Wireshark**是非常强大的网络数据包分析器，通过其内置的过滤器，可以快速找到并过滤出存在异常问题的终端设备。
	- 端口过滤
	- src ip 过滤
	- 内容过滤 
		- `tcp contains "ascii"` 
		- `tcp contains FF:FF:FF`
3. 逆向网络协议。**ImHex**是一款出色的十六进制编辑工具，内置字节编辑工具和模式语言方便对报文进行逆向分析。

# 总结
对设备、术语和协议有了横向的了解。也知道了怎样对常见的网络问题进行排查？最后还对如何分析报文所使用的工具进行简单的介绍。